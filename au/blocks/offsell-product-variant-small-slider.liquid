<link rel="stylesheet" href="{{ 'swiper.css' | asset_url }}">
<script src="{{ 'swiper.js' | asset_url }}" defer></script>

{% style %}
    #{{ block.id }}.offsell-product-small-slider-variant-container {
      max-width: calc( 169.5px * {{block.settings.per_view_count}} + 7px * ({{block.settings.per_view_count | minus: 1}}));
    }

    .offsell-product-small-slider-variant-container {
      width: 100%;
      height: 294.5px;
      position: relative;
    }

    .offsell-product-small-slider-variant {
      height: 100%;
      overflow: hidden;
    }
    .offsell-product-small-slider-variant .swiper-slide {
      /* width: 169.5px !important;
      height: 295.5px !important; */
      border-radius: 10px;
      user-select: none;
      overflow: hidden;
    }
    .offsell-product-small-slider-variant .swiper-slide img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .offsell-product-variant-card {
      width: 100%;
      height: 100%;

    }

    .offsell-product-variant-card .product-block {
      background-color: #ffffff;
      border-radius: 12px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }


    /* 产品图片样式 */
    .offsell-product-variant-card .product-image-container {
      position: relative;
      width: 100%;
      height: 182.5px;
      padding: 15.5px;
      background-color: #fff;
    }
    .offsell-product-variant-card .offsell-product-image {
      width: 100%;
      height: 100%;
      background-size: cover;
      background-position: center;
    }

    .offsell-product-variant-card .discount-badge {
      position: absolute;
      top: 15px;
      left: 0;
      color: #000;
      padding: 5px 6px 5px 8px;
      font-size: 12px;
      line-height: 1;
      font-weight: bold;
      z-index: 1;
      background: linear-gradient(-28deg, #f9d231, #fffcbb, #d48d02);
      text-align: center;
    }
    .offsell-product-variant-card .discount-badge::before {
      content: "";
      border-right: 11px solid transparent;
      border-top: 11px solid #FFF071;
      border-bottom: 11px solid #F9D231;
      position: absolute;
      left: 100%;
      top: 0;
      bottom: 0;
    }

    /* 产品信息样式 */
    .offsell-product-variant-card .product-info {
      width: 100%;
      padding-bottom: 13.5px;
    }

    .offsell-product-variant-card .level-badge {
      background-color: #d68c00;
      color: white;
      width: fit-content;
      padding: 5px 12px;
      border-radius: 11px;
      font-size: 10px;
      line-height: 12px;
      margin-bottom: 10px;
    }

    .offsell-product-variant-card .product-title {
      font-size: 10px;
      font-weight: bold;
      text-align: center;
      color: #000;
      line-height: 12px;
      max-height: 36px;
      margin: 9.5px 11px 0;

      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
    }

    .offsell-product-variant-card .product-description {
      font-size: 10px;
      color: #808080;
      line-height: 1;
      font-weight: 600;
      max-height: 36px;
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
    }

    .offsell-product-variant-card .footer-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      margin-top: auto;
    }
    /* 价格样式 */
    .offsell-product-variant-card .price-container {
      display: flex;
      align-items: end;
      flex-wrap: wrap;
      gap: 6px;
    }

    .offsell-product-variant-card .original-price {
      text-decoration: line-through;
      color: #666;
      font-size: 12px;
      line-height: 1;
      font-weight: 600;
      margin-bottom: 2px;
    }

    .offsell-product-variant-card .current-price {
      font-size: 18px;
      color: #d48d02;
      line-height: 1;
      font-weight: 600;
    }

    /* 按钮样式 */
    .offsell-product-variant-card .button-container {
      display: flex;
      gap: 10px;
    }
    .offsell-product-variant-card .button-container .card-action {
      width: fit-content;
    }

    .offsell-product-variant-card .button {
      padding: 7px 14.5px !important;
      border-radius: 14px;
      text-decoration: none;
      text-align: center;
      font-weight: bold;
      font-size: 10px;
      line-height: 1;
      background: linear-gradient(-28deg, #f9d231, #fffcbb, #d48d02);
      color: #000;
      border: none;
      cursor: pointer;
      white-space: nowrap;
      width: fit-content;
      min-width: unset;
    }
    .offsell-product-variant-card .button:hover {
      background: linear-gradient(-28deg, #f9d231, #fffcbb, #d48d02);
      color: #000;
      border: none;
      box-shadow: none;
    }
    .offsell-product-variant-card .is-loading.button {
      width: 90px;
      height: 24px;
    }
    .offsell-product-variant-card .is-loading.button:hover {
      background: none;
    }
    .offsell-product-variant-card .is-loading.button:before {
      left: 40%;
      transform: translateX(0);
    }

    .offsell-product-small-slider-variant-container .swiper-button-next,
    .offsell-product-small-slider-variant-container .swiper-button-prev {
      width: 31px;
      height: 31px;
      color: #fff;
      background-color: #d48d02;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .offsell-product-small-slider-variant-container .swiper-button-next:after,
    .offsell-product-small-slider-variant-container .swiper-button-prev:after {
      display: none;
    }

    /* 导航按钮外部位置样式 */
    .offsell-product-small-slider-variant-container.nav-outside .swiper-button-prev {
      left: 0;
      transform: translateX(calc(-100% - 12px));
    }
    .offsell-product-small-slider-variant-container.nav-outside .swiper-button-next {
      right: 0;
      transform: translateX(calc(100% + 12px));
    }

    /* 导航按钮内部位置样式 */
    .offsell-product-small-slider-variant-container.nav-inside .swiper-button-prev {
      left: 10px;
      z-index: 10;
    }
    .offsell-product-small-slider-variant-container.nav-inside .swiper-button-next {
      right: 10px;
      z-index: 10;
    }

    .offsell-product-small-slider-variant-container .swiper-button-prev svg {
      transform: translateX(-1px) scale(1.5);
      transform-origin: center;
    }
    .offsell-product-small-slider-variant-container .swiper-button-next svg {
      transform: translateX(1px) scale(1.5);
      transform-origin: center;
    }

    /* 增加响应式设计 */
    @media (max-width: 900px) {
      .offsell-product-small-slider-variant-container {
        width: 95%;
        max-width: 700px;
        height: calc(294.5px * 2 + 7px);
      }

      .offsell-product-small-slider-variant .swiper-slide {
        height: 294.5px !important;
      }

      .offsell-product-variant-card .product-title {
        text-align: center;
      }

      .offsell-product-variant-card .current-price {
        font-size: 16px;
      }
      .offsell-product-variant-card .original-price {
        margin-bottom: 0;
      }

      /* 隐藏滑动按钮 */
      .offsell-product-small-slider-variant-container .swiper-button-next,
      .offsell-product-small-slider-variant-container .swiper-button-prev {
        display: none;
      }
    }

    @media (min-width: 1920px) {
      #{{ block.id }}.offsell-product-small-slider-variant-container {
        max-width: calc( 13.242vw * {{block.settings.per_view_count}} + 0.547vw * ({{block.settings.per_view_count | minus: 1}}));
      }

      .offsell-product-small-slider-variant-container {
        width: 100%;
        height: 23.008vw;
        position: relative;
      }

      .offsell-product-small-slider-variant {
        height: 100%;
        overflow: hidden;
      }
      .offsell-product-small-slider-variant .swiper-slide {
        /* width: 13.242vw !important;
        height: 23.086vw !important; */
        border-radius: 0.78125vw;
        user-select: none;
        overflow: hidden;
      }
      .offsell-product-small-slider-variant .swiper-slide img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
      .offsell-product-variant-card {
        width: 100%;
        height: 100%;
      }

      .offsell-product-variant-card .product-block {
        background-color: #ffffff;
        border-radius: 0.9375vw;
        overflow: hidden;
        display: flex;
        flex-direction: column;
      }


      /* 产品图片样式 */
      .offsell-product-variant-card .product-image-container {
        position: relative;
        width: 100%;
        height: 14.258vw;
        padding: 1.211vw;
        background-color: #fff;
      }
      .offsell-product-variant-card .offsell-product-image {
        width: 100%;
        height: 100%;
        background-size: cover;
        background-position: center;
      }

      .offsell-product-variant-card .discount-badge {
        position: absolute;
        top: 1.172vw;
        left: 0;
        color: #000;
        padding: 0.391vw 0.46875vw 0.391vw 0.625vw;
        font-size: 0.9375vw;
        line-height: 1;
        font-weight: bold;
        z-index: 1;
        background: linear-gradient(-28deg, #f9d231, #fffcbb, #d48d02);
        text-align: center;
      }
      .offsell-product-variant-card .discount-badge::before {
        content: "";
        border-right: 0.859vw solid transparent;
        border-top: 0.859vw solid #FFF071;
        border-bottom: 0.859vw solid #F9D231;
        position: absolute;
        left: 100%;
        top: 0;
        bottom: 0;
      }

      /* 产品信息样式 */
      .offsell-product-variant-card .product-info {
        width: 100%;
        padding-bottom: 1.055vw;
      }

      .offsell-product-variant-card .level-badge {
        background-color: #d68c00;
        color: white;
        width: fit-content;
        padding: 0.391vw 0.9375vw;
        border-radius: 0.859vw;
        font-size: 0.78125vw;
        line-height: 0.9375vw;
        margin-bottom: 0.78125vw;
      }

      .offsell-product-variant-card .product-title {
        font-size: 0.78125vw;
        font-weight: bold;
        text-align: center;
        color: #000;
        line-height: 0.9375vw;
        max-height: 2.8125vw;
        margin: 0.742vw 0.859vw 0;

        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
      }

      .offsell-product-variant-card .product-description {
        font-size: 0.78125vw;
        color: #808080;
        line-height: 1;
        font-weight: 600;
        max-height: 2.8125vw;
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
      }

      .offsell-product-variant-card .footer-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.9375vw;
        margin-top: auto;
      }
      /* 价格样式 */
      .offsell-product-variant-card .price-container {
        display: flex;
        align-items: end;
        flex-wrap: wrap;
        gap: 0.46875vw;
      }

      .offsell-product-variant-card .original-price {
        text-decoration: line-through;
        color: #666;
        font-size: 0.9375vw;
        line-height: 1;
        font-weight: 600;
        margin-bottom: 0.15625vw;
      }

      .offsell-product-variant-card .current-price {
        font-size: 1.40625vw;
        color: #d48d02;
        line-height: 1;
        font-weight: 600;
      }

      /* 按钮样式 */
      .offsell-product-variant-card .button-container {
        display: flex;
        gap: 0.78125vw;
      }
      .offsell-product-variant-card .button-container .card-action {
        width: fit-content;
      }

      .offsell-product-variant-card .button {
        padding: 0.547vw 1.133vw !important;
        border-radius: 1.09375vw;
        text-decoration: none;
        text-align: center;
        font-weight: bold;
        font-size: 0.78125vw;
        line-height: 1;
        background: linear-gradient(-28deg, #f9d231, #fffcbb, #d48d02);
        color: #000;
        border: none;
        cursor: pointer;
        white-space: nowrap;
        width: fit-content;
        min-width: unset;
      }
      .offsell-product-variant-card .button:hover {
        background: linear-gradient(-28deg, #f9d231, #fffcbb, #d48d02);
        color: #000;
        border: none;
        box-shadow: none;
      }
      .offsell-product-variant-card .is-loading.button {
        width: 7.03125vw;
        height: 1.875vw;
      }
      .offsell-product-variant-card .is-loading.button:hover {
        background: none;
      }
      .offsell-product-variant-card .is-loading.button:before {
        left: 40%;
        transform: translateX(0);
      }

      .offsell-product-small-slider-variant-container .swiper-button-next,
      .offsell-product-small-slider-variant-container .swiper-button-prev {
        width: 2.422vw;
        height: 2.422vw;
        color: #fff;
        background-color: #d48d02;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .offsell-product-small-slider-variant-container .swiper-button-next:after,
      .offsell-product-small-slider-variant-container .swiper-button-prev:after {
        display: none;
      }

      /* 导航按钮外部位置样式 */
      .offsell-product-small-slider-variant-container.nav-outside .swiper-button-prev {
        left: 0;
        transform: translateX(calc(-100% - 0.9375vw));
      }
      .offsell-product-small-slider-variant-container.nav-outside .swiper-button-next {
        right: 0;
        transform: translateX(calc(100% + 0.9375vw));
      }

      /* 导航按钮内部位置样式 */
      .offsell-product-small-slider-variant-container.nav-inside .swiper-button-prev {
        left: 0.78125vw;
        z-index: 10;
      }
      .offsell-product-small-slider-variant-container.nav-inside .swiper-button-next {
        right: 0.78125vw;
        z-index: 10;
      }

      .offsell-product-small-slider-variant-container .swiper-button-prev svg {
        transform: translateX(-0.078vw) scale(1.5);
        transform-origin: center;
      }
      .offsell-product-small-slider-variant-container .swiper-button-next svg {
        transform: translateX(0.078vw) scale(1.5);
        transform-origin: center;
      }
    }
{% endstyle %}

<div
  id="{{ block.id }}"
  class="offsell-product-small-slider-variant-container nav-{{ block.settings.navigation_position }}"
>
  <div id="{{ block.id }}-swiper" class="swiper offsell-product-small-slider-variant">
    <div class="swiper-wrapper">
      {% for product in block.settings.collection.products %}
        <div class="swiper-slide">
          <div class="offsell-product-variant-card">
            <div class="product-block">
              <!-- 产品图片部分 -->
              <div class="product-image-container">
                {% unless product.compare_at_price == product.price %}
                  <div class="discount-badge">
                    {% assign discount_amount = product.compare_at_price | minus: product.price %}
                    {% assign discount_percentage = discount_amount
                      | times: 100
                      | divided_by: product.compare_at_price
                    %}
                    <p class="discount-text">Save {{ discount_percentage }}%</p>
                  </div>
                {% endunless %}
                <div
                  class="offsell-product-image"
                  style="background-image: url('{{ product.featured_image | img_url: 'master' }}');"
                ></div>
              </div>

              <!-- 产品信息部分 -->
              <div class="product-info">
                <div class="footer-container">
                  <!-- 价格信息 -->
                  <div class="price-container">
                    <div class="current-price">{{ product.price | money }}</div>
                    <div class="original-price">{{ product.compare_at_price | money }}</div>
                  </div>

                  <!-- 按钮区域 -->
                  <div class="button-container">
                    {% comment %}
                      {% form 'product', product %}
                        <input type="hidden" name="id" value="{{ product.variants.first.id }}">
                        <button type="submit" class="add-cart-btn" id="add-to-cart-{{ product.id }}">ADD TO CART</button>
                      {% endform %}
                    {% endcomment %}
                    <div class="card-action">
                      {% render 'add-to-cart-form',
                        product: product,
                        id: 'form',
                        position: position,
                        sectionId: sectionId
                      %}
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- 产品标题和描述 -->
            <p class="product-title" title="{{ product.title }}">{{ product.title }}</p>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
  <div id="{{ block.id }}-swiper-button-next" class="swiper-button-next">
    <svg width="12" height="12" viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg">
      <path d="M4 2L8 6L4 10" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
    </svg>
  </div>
  <div id="{{ block.id }}-swiper-button-prev" class="swiper-button-prev">
    <svg width="12" height="12" viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg">
      <path d="M8 2L4 6L8 10" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
    </svg>
  </div>
</div>

<script defer>
  function init() {
    if (typeof Swiper !== 'undefined') {
      swiper = new Swiper('#{{ block.id }}-swiper', {
        slidesPerView: 1,
        spaceBetween: 7,
        // loop: true,
        navigation: {
          nextEl: '#{{ block.id }}-swiper-button-next',
          prevEl: '#{{ block.id }}-swiper-button-prev',
        },
        autoplay: {
          delay: 2000,
          disableOnInteraction: false,
          pauseOnMouseEnter: true,
        },
        breakpoints: {
          320: {
            slidesPerView: 2,
            grid: {
              rows: 2,
            }
          },
          900: {
            slidesPerView: {{ block.settings.per_view_count }},
            grid: {
              rows: 1,
            }
          },
        },
      });
    } else {
      console.error('Swiper库未加载成功');
    }
  }

  document.addEventListener('DOMContentLoaded', init);

  // shopify block load
  document.addEventListener('shopify:block:load', init);
</script>

{% schema %}
{
  "name": "促销产品轮播图-小-变体",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "产品"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "产品集合"
    },
    {
      "type": "number",
      "id": "per_view_count",
      "label": "每页显示数量",
      "default": 4
    },
    {
      "type": "select",
      "id": "navigation_position",
      "label": "导航按钮位置",
      "options": [
        {
          "value": "outside",
          "label": "外部"
        },
        {
          "value": "inside",
          "label": "内部"
        }
      ],
      "default": "outside"
    }
  ],
  "presets": [
    {
      "name": "促销产品轮播图-小-变体"
    }
  ]
}
{% endschema %}
