{{- 'faq-section.css' | asset_url | stylesheet_tag -}}

<div class="faq-section section-spacing" style="--color-bg: {{ section.settings.color_bg }}; --color-heading: {{ section.settings.color_heading }}; --color-text: {{ section.settings.color_text }}; --color-border: {{ section.settings.color_border }}; --color-accent: {{ section.settings.color_accent }};">
  
  <div class="faq-section__content">
    {% assign categories = section.blocks | where: "type", "faq_category" %}
    {% assign category_count = categories.size %}
    
    {% if category_count > 1 %}
      <!-- å·¦ä¾§å¯¼èˆªèœå• -->
      <div class="faq-navigation">
        <div class="faq-categories">
          {% for category in categories %}
            {% assign category_id = 'category_' | append: forloop.index %}
            <div class="faq-category-item {% if forloop.first %}active{% endif %}" 
                 data-category="{{ category_id }}" 
                 onclick="switchFaqCategory('{{ category_id }}')"
                 style="cursor: pointer;">
              <span class="category-number">{{ forloop.index }}</span>
              <span class="category-name">{{ category.settings.category_name }}</span>
            </div>
          {% endfor %}
        </div>
      </div>
    {% endif %}

    <!-- å³ä¾§å†…å®¹åŒºåŸŸ -->
    <div class="faq-content {% if category_count <= 1 %}single-category{% endif %}">
      {% for category in categories %}
        {% assign category_id = 'category_' | append: forloop.index %}
        <div class="faq-category-content {% if forloop.first %}active{% endif %}" id="content-{{ category_id }}">
          
          
          {% comment %} ç›´æ¥å¤„ç†æ ‡é¢˜åˆ†ç»„ {% endcomment %}
          {% assign found_titles = false %}
          {% for title_block in section.blocks %}
            {% if title_block.type == "faq_title" and title_block.settings.category_id == category.settings.category_id %}
              {% assign found_titles = true %}
              <div class="faq-title-section">
                <h3 class="faq-section-title">{{ title_block.settings.title }}</h3>
                
                <div class="faq-questions">
                  {% comment %} æ˜¾ç¤ºè¯¥æ ‡é¢˜ä¸‹çš„æ‰€æœ‰é—®ç­” - ä½¿ç”¨åŠ¨æ€é—®ç­”å— {% endcomment %}
                  {% assign has_questions = false %}
                  
                  {% comment %} æ˜¾ç¤ºå±äºå½“å‰æ ‡é¢˜åˆ†ç»„çš„é—®ç­”å— {% endcomment %}
                  {% for qa_block in section.blocks %}
                    {% if qa_block.type == "faq_question" and qa_block.settings.title_id == title_block.settings.title_id %}
                      <div class="faq-item">
                        <div class="faq-question">
                          <span class="question-text"><strong>Q: "{{ qa_block.settings.question }}"</strong></span>
                        </div>
                        <div class="faq-answer">
                          <p>{{ qa_block.settings.answer | strip_html }}</p>
                        </div>
                      </div>
                      {% assign has_questions = true %}
                    {% endif %}
                  {% endfor %}
                  
                  {% if has_questions == false %}
                    <div class="no-questions">
                      <p>æš‚æ— ç›¸å…³é—®é¢˜</p>
                    </div>
                  {% endif %}
                </div>
              </div>
            {% endif %}
          {% endfor %}
          
          {% if found_titles == false %}
            {% comment %} å¦‚æœæ²¡æœ‰æ ‡é¢˜åˆ†ç»„ï¼Œæ˜¾ç¤ºåˆ†ç±»æ ‡é¢˜å’Œç‹¬ç«‹é—®é¢˜ {% endcomment %}
            <div class="faq-title-section">
              <h3 class="faq-section-title">
                {% if category.settings.category_title != blank %}
                  {{ category.settings.category_title }}
                {% else %}
                  {{ category.settings.category_name }}
                {% endif %}
              </h3>
              
              <div class="faq-questions">
                {% assign category_questions = section.blocks | where: "type", "faq_question" | where: "settings.category_id", category.settings.category_id %}
                {% for question_block in category_questions %}
                  <div class="faq-item">
                    <div class="faq-question">
                      <span class="question-text"><strong>Q: "{{ question_block.settings.question }}"</strong></span>
                    </div>
                    <div class="faq-answer">
                      <p>{{ question_block.settings.answer | strip_html }}</p>
                    </div>
                  </div>
                {% endfor %}
                
                {% if category_questions.size == 0 %}
                  <div class="no-questions">
                    <p>æš‚æ— ç›¸å…³é—®é¢˜</p>
                  </div>
                {% endif %}
              </div>
            </div>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  </div>
</div>

<script>
// FAQåŠŸèƒ½ç±»
class FaqManager {
  constructor() {
    this.init();
  }

  init() {
    this.initializeFaqState();
    this.setupEventListeners();
  }

  initializeFaqState() {
    // ç›´æ¥æ˜¾ç¤ºæ¨¡å¼ï¼Œæ— éœ€åˆå§‹åŒ–æŠ˜å çŠ¶æ€
    console.log('FAQ åˆå§‹åŒ–ä¸ºç›´æ¥æ˜¾ç¤ºæ¨¡å¼');
  }

  setupEventListeners() {
    // ä½¿ç”¨äº‹ä»¶å§”æ‰˜æ¥å¤„ç†ç‚¹å‡»äº‹ä»¶
    const faqContainer = document.querySelector('.faq-section');
    if (faqContainer) {
      faqContainer.addEventListener('click', (e) => {
        const categoryItem = e.target.closest('.faq-category-item');
        if (categoryItem) {
          e.preventDefault();
          const categoryId = categoryItem.getAttribute('data-category');
          console.log('ç‚¹å‡»åˆ†ç±»:', categoryId);
          this.switchFaqCategory(categoryId);
        }
      });
      console.log('FAQ äº‹ä»¶ç›‘å¬å™¨è®¾ç½®å®Œæˆ');
    } else {
      console.error('æœªæ‰¾åˆ°FAQå®¹å™¨å…ƒç´ ');
    }
  }

  switchFaqCategory(categoryId) {
    console.log('åˆ‡æ¢åˆ†ç±»åˆ°:', categoryId);
    
  // éšè—æ‰€æœ‰å†…å®¹
  document.querySelectorAll('.faq-category-content').forEach(content => {
    content.classList.remove('active');
  });
  
  // ç§»é™¤æ‰€æœ‰å¯¼èˆªé¡¹çš„activeçŠ¶æ€
  document.querySelectorAll('.faq-category-item').forEach(item => {
    item.classList.remove('active');
  });
  
  // æ˜¾ç¤ºé€‰ä¸­çš„å†…å®¹
  const selectedContent = document.getElementById('content-' + categoryId);
  if (selectedContent) {
    selectedContent.classList.add('active');
      console.log('æ˜¾ç¤ºå†…å®¹:', selectedContent.id);
    } else {
      console.error('æœªæ‰¾åˆ°å†…å®¹å…ƒç´ :', 'content-' + categoryId);
  }
  
  // æ¿€æ´»é€‰ä¸­çš„å¯¼èˆªé¡¹
  const selectedNav = document.querySelector(`[data-category="${categoryId}"]`);
  if (selectedNav) {
    selectedNav.classList.add('active');
      console.log('æ¿€æ´»å¯¼èˆª:', selectedNav.textContent);
    } else {
      console.error('æœªæ‰¾åˆ°å¯¼èˆªå…ƒç´ :', `[data-category="${categoryId}"]`);
    }

    // æ»šåŠ¨åˆ°é¡¶éƒ¨
    const faqContent = document.querySelector('.faq-content');
    if (faqContent) {
      faqContent.scrollTop = 0;
    }
  }

  // ä¸å†éœ€è¦æŠ˜å åŠŸèƒ½
}

// å…¨å±€å‡½æ•°ï¼Œä¿æŒå‘åå…¼å®¹
function switchFaqCategory(categoryId) {
  if (window.faqManager) {
    window.faqManager.switchFaqCategory(categoryId);
  }
}

// ä¸å†éœ€è¦æŠ˜å åŠŸèƒ½

// é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–FAQçŠ¶æ€
document.addEventListener('DOMContentLoaded', function() {
  // å»¶è¿Ÿä¸€ç‚¹æ—¶é—´ç¡®ä¿DOMå®Œå…¨æ¸²æŸ“
  setTimeout(() => {
    window.faqManager = new FaqManager();
    
    // æµ‹è¯•åˆ‡æ¢åŠŸèƒ½
    console.log('FAQ Manager åˆå§‹åŒ–å®Œæˆ');
    console.log('æ‰€æœ‰åˆ†ç±»å†…å®¹:', document.querySelectorAll('.faq-category-content'));
    console.log('æ‰€æœ‰å¯¼èˆªé¡¹:', document.querySelectorAll('.faq-category-item'));
    
    // éªŒè¯äº‹ä»¶ç»‘å®š
    const categoryItems = document.querySelectorAll('.faq-category-item');
    console.log('æ‰¾åˆ°åˆ†ç±»é¡¹æ•°é‡:', categoryItems.length);
    categoryItems.forEach((item, index) => {
      console.log(`åˆ†ç±»é¡¹${index + 1}:`, item.getAttribute('data-category'));
    });
  }, 100);
});
</script>

{% schema %}
{
  "name": "FAQ å¸¸è§é—®é¢˜",
  "class": "section-faq",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "ä¸»æ ‡é¢˜",
      "default": "Frequently Asked Questions"
    },
    {
      "type": "textarea",
      "id": "subheading",
      "label": "å‰¯æ ‡é¢˜",
      "info": "å¯é€‰ï¼Œæ˜¾ç¤ºåœ¨ä¸»æ ‡é¢˜ä¸‹æ–¹",
      "default": "Find answers to common questions about our products and services"
    },
    {
      "type": "header",
      "content": "å¸ƒå±€è®¾ç½®"
    },
    {
      "type": "select",
      "id": "layout_style",
      "label": "å¸ƒå±€æ ·å¼",
      "options": [
        {
          "value": "sidebar",
          "label": "ä¾§è¾¹æ å¸ƒå±€"
        },
        {
          "value": "tabs",
          "label": "æ ‡ç­¾é¡µå¸ƒå±€"
        },
        {
          "value": "accordion",
          "label": "æ‰‹é£ç´å¸ƒå±€"
        }
      ],
      "default": "sidebar"
    },
    {
      "type": "checkbox",
      "id": "show_category_numbers",
      "label": "æ˜¾ç¤ºåˆ†ç±»ç¼–å·",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_question_numbers",
      "label": "æ˜¾ç¤ºé—®é¢˜ç¼–å·",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "debug_mode",
      "label": "è°ƒè¯•æ¨¡å¼",
      "info": "å¼€å¯åæ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯ï¼Œå¸®åŠ©æ’æŸ¥é—®é¢˜",
      "default": false
    },
    {
      "type": "header",
      "content": "é¢œè‰²è®¾ç½®"
    },
    {
      "type": "color",
      "id": "color_bg",
      "label": "èƒŒæ™¯é¢œè‰²",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "color_heading",
      "label": "æ ‡é¢˜é¢œè‰²",
      "default": "#1a1c1d"
    },
    {
      "type": "color",
      "id": "color_text",
      "label": "æ–‡å­—é¢œè‰²",
      "default": "#2c2d2e"
    },
    {
      "type": "color",
      "id": "color_border",
      "label": "è¾¹æ¡†é¢œè‰²",
      "default": "#DADCE0"
    },
    {
      "type": "color",
      "id": "color_accent",
      "label": "å¼ºè°ƒè‰²",
      "default": "#1d80dc"
    }
  ],
  "blocks": [
    {
      "type": "faq_category",
      "name": "FAQåˆ†ç±»",
      "settings": [
        {
          "type": "text",
          "id": "category_id",
          "label": "åˆ†ç±»ID",
          "info": "ç”¨äºå…³è”é—®é¢˜ï¼Œè¯·ä½¿ç”¨è‹±æ–‡å’Œæ•°å­—",
          "default": "general_category"
        },
        {
          "type": "text",
          "id": "category_name",
          "label": "åˆ†ç±»åç§°",
          "default": "å¸¸è§é—®é¢˜"
        },
        {
          "type": "text",
          "id": "category_title",
          "label": "åˆ†ç±»æ ‡é¢˜",
          "info": "å¯é€‰ï¼Œæ˜¾ç¤ºåœ¨åˆ†ç±»å†…å®¹é¡¶éƒ¨"
        },
        {
          "type": "textarea",
          "id": "category_description",
          "label": "åˆ†ç±»æè¿°",
          "info": "å¯é€‰ï¼Œæ˜¾ç¤ºåœ¨åˆ†ç±»æ ‡é¢˜ä¸‹æ–¹"
        },
        {
          "type": "text",
          "id": "category_icon",
          "label": "åˆ†ç±»å›¾æ ‡",
          "info": "å¯é€‰ï¼Œæ˜¾ç¤ºåœ¨åˆ†ç±»åç§°æ—è¾¹ï¼ˆå¦‚ï¼šğŸ“¦ã€ğŸ’¡ç­‰ï¼‰"
        },
        {
          "type": "checkbox",
          "id": "show_more_link",
          "label": "æ˜¾ç¤ºæ›´å¤šé“¾æ¥",
          "default": false
        },
        {
          "type": "text",
          "id": "more_link_text",
          "label": "æ›´å¤šé“¾æ¥æ–‡å­—",
          "default": "æŸ¥çœ‹æ›´å¤š"
        },
        {
          "type": "url",
          "id": "more_link_url",
          "label": "æ›´å¤šé“¾æ¥åœ°å€"
        }
      ]
    },
    {
      "type": "faq_title",
      "name": "FAQæ ‡é¢˜åˆ†ç»„",
      "settings": [
        {
          "type": "text",
          "id": "category_id",
          "label": "æ‰€å±åˆ†ç±»ID",
          "info": "å¿…é¡»ä¸åˆ†ç±»çš„category_idåŒ¹é…",
          "default": "general_category"
        },
        {
          "type": "text",
          "id": "title_id",
          "label": "æ ‡é¢˜ID",
          "info": "ç”¨äºå…³è”é—®é¢˜ï¼Œè¯·ä½¿ç”¨è‹±æ–‡å’Œæ•°å­—",
          "default": "title_1"
        },
        {
          "type": "text",
          "id": "title",
          "label": "æ ‡é¢˜",
          "default": "1. Pre-sale Questions"
        },
      ]
    },
    {
      "type": "faq_question",
      "name": "FAQé—®é¢˜",
      "settings": [
        {
          "type": "text",
          "id": "category_id",
          "label": "æ‰€å±åˆ†ç±»ID",
          "info": "å¿…é¡»ä¸åˆ†ç±»çš„category_idåŒ¹é…",
          "default": "general_category"
        },
        {
          "type": "text",
          "id": "title_id",
          "label": "æ‰€å±æ ‡é¢˜ID",
          "info": "å¿…é¡»ä¸æ ‡é¢˜åˆ†ç»„çš„title_idåŒ¹é…",
          "default": "title_1"
        },
        {
          "type": "text",
          "id": "question",
          "label": "é—®é¢˜",
          "default": "è¿™æ˜¯ä¸€ä¸ªå¸¸è§é—®é¢˜å—ï¼Ÿ"
        },
        {
          "type": "richtext",
          "id": "answer",
          "label": "ç­”æ¡ˆ",
          "info": "æ”¯æŒå¯Œæ–‡æœ¬æ ¼å¼"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "FAQ å¸¸è§é—®é¢˜",
      "blocks": [
        {
          "type": "faq_category",
          "settings": {
            "category_id": "general_category",
            "category_name": "General Questions",
            "category_title": "1. Pre-sale Questions",
            "category_description": "å”®å‰ç›¸å…³é—®é¢˜è§£ç­”",
            "category_icon": "â“"
          }
        },
        {
          "type": "faq_category",
          "settings": {
            "category_id": "products_category",
            "category_name": "Products/Services Questions",
            "category_title": "2. Device Questions",
            "category_description": "äº§å“è®¾å¤‡ç›¸å…³é—®é¢˜",
            "category_icon": "ğŸ”§"
          }
        },
        {
          "type": "faq_category",
          "settings": {
            "category_id": "account_category",
            "category_name": "Account Questions",
            "category_title": "3. Account Management",
            "category_description": "è´¦æˆ·ç®¡ç†ç›¸å…³é—®é¢˜",
            "category_icon": "ğŸ‘¤"
          }
        },
        {
          "type": "faq_category",
          "settings": {
            "category_id": "technical_category",
            "category_name": "Technical Questions",
            "category_title": "4. Technical Support",
            "category_description": "æŠ€æœ¯æ”¯æŒç›¸å…³é—®é¢˜",
            "category_icon": "âš™ï¸"
          }
        },
        {
          "type": "faq_category",
          "settings": {
            "category_id": "contact_category",
            "category_name": "Contact Questions",
            "category_title": "5. Contact Information",
            "category_description": "è”ç³»æ–¹å¼ç›¸å…³é—®é¢˜",
            "category_icon": "ğŸ“"
          }
        },
        {
          "type": "faq_category",
          "settings": {
            "category_id": "returns_category",
            "category_name": "Refund & Return Questions",
            "category_title": "6. Refund & Return Policy",
            "category_description": "é€€æ¢è´§æ”¿ç­–ç›¸å…³é—®é¢˜",
            "category_icon": "ğŸ”„"
          }
        },
        {
          "type": "faq_category",
          "settings": {
            "category_id": "tutorials_category",
            "category_name": "How-to Tutorials",
            "category_title": "7. How-to Tutorials",
            "category_description": "ä½¿ç”¨æ•™ç¨‹å’ŒæŒ‡å—",
            "category_icon": "ğŸ“š"
          }
        },
        {
          "type": "faq_title",
          "settings": {
            "category_id": "general_category",
            "title_id": "presale_title",
            "title": "1. Pre-sale Questions",
          }
        },
        {
          "type": "faq_title",
          "settings": {
            "category_id": "products_category",
            "title_id": "device_title",
            "title": "2. Device Questions",
          }
        },
        {
          "type": "faq_question",
          "settings": {
            "category_id": "general_category",
            "title_id": "presale_title",
            "question": "Do you offer any special pricing for bulk orders?",
            "answer": "<p>Yes, discounts are available for purchases of more than 5 machines and more than 15 accessories or consumables of the same model. Please contact our customer service for specific discount gradients.</p>",
          }
        },
        {
          "type": "faq_question",
          "settings": {
            "category_id": "general_category",
            "title_id": "presale_title",
            "question": "How does this product compare to similar products on the market?",
            "answer": "<p>Our brand offers a unique appeal in the realm of carving machines. We stand out by providing machines at various price points, catering to beginners and enthusiasts alike. With a range of products spanning multiple price ranges, customers can choose according to their needs.</p>",
          }
        },
        {
          "type": "faq_question",
          "settings": {
            "category_id": "general_category",
            "title_id": "presale_title",
            "question": "What payment methods do you accept?",
            "answer": "<p>A variety of payment methods are accepted, including credit cards, Shop Pay, PayPal, and more, with customers able to choose their preferred method at checkout.</p>",
          }
        },
        {
          "type": "faq_question",
          "settings": {
            "category_id": "products_category",
            "title_id": "device_title",
            "question": "What will happen when the device loses power during operation?",
            "answer": "<p>If the device loses power during an engraving task, the laser head remains in place. Upon powering on again, it initializes but does not resume the original task.</p>",
          }
        },
        {
          "type": "faq_question",
          "settings": {
            "category_id": "products_category",
            "title_id": "device_title",
            "question": "Why is the engraved pattern so different from the original drawing?",
            "answer": "<p>Several factors can affect the final engraved pattern: material properties, power settings, speed settings, focus distance, and file resolution. Please ensure your settings match the material specifications and use high-quality source files.</p>",
          }
        }
      ]
    }
  ],
  "enabled_on": {
    "templates": ["*"],
    "groups": ["header", "footer"]
  }
}
{% endschema %}
