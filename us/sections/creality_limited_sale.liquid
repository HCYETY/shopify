<style>
  #container-{{section.id}} {
    background-color: {{ section.settings.bg_color }}; 
  }
  @media (min-width: 1200px) {
    #container-{{section.id}} {
      padding-top: {{ section.settings.mg_top_desktop | append: 'px' }};
      padding-bottom: {{ section.settings.mg_bottom_desktop | append: 'px' }}
    } 
  }
  @media (min-width: 768px) and (max-width: 1024px) {
    #container-{{section.id}} { 
      padding-top: {{ section.settings.mg_top_tablet | append: 'px' }};
      padding-bottom: {{ section.settings.mg_bottom_tablet | append: 'px' }}
    }
  }
  .sale-wrap {
    width: 52.083vw;
    margin: 0 auto;
  }
  .sale-wrap .sale-title {
    font-family: 'HarmonyOS_Sans_SC_Bold';
    font-size: 1.679vw;
    font-weight: 600;
    text-align: center;
    margin-bottom: 0.833vw;
  }
  .sale-wrap .sale-subtitle {
    font-family: 'HarmonyOS_Sans_SC_Bold';
    font-size: 0.833vw;
    font-weight: 500;
    text-align: center;
    margin-bottom: 1.563vw;
  }
  .sale-wrap .sale-list {
    display: flex;
  }
  .sale-wrap .sale-list .sale-item {
    /* padding: 1.042vw 1.563vw 2.604vw 1.563vw; */
    border-radius: 0.781vw;
    overflow: hidden;
    position: relative;
    flex: 1;
    margin-right: 1.042vw;
    background-color: #fff;
    padding-bottom: 1.042vw;
  }
  .sale-wrap .sale-list .sale-item:last-child {
    margin-right: 0;
  }
  .sale-wrap .sale-list .sale-item .sale-icon-wrap {
    width: 5.208vw;
    position: absolute;
    right: 0.833vw;
    top: 0;
  }
  .sale-wrap .sale-list .sale-item .sale-icon-wrap .discount {
    position: absolute;
    font-size: 1.458vw;
    right: 1.667vw;
    font-weight: 600;
    color: #fff;
    top: 1.823vw;
  }
  .sale-wrap .sale-list .sale-item .sale-icon-wrap .off {
    position: absolute;
    font-size: 1.042vw;
    right: 1.406vw;
    font-weight: 400;
    color: #fff;
    top: 3.333vw;
  }
  .sale-wrap .sale-list .sale-item .sale-icon-wrap .sale-icon {
    width: 100%;
  }
  .sale-wrap .sale-list .sale-item .product-img {
    width: 100%;
  }
  .sale-wrap .sale-list .sale-item .progress-wrap {
    width: 20.208vw;
    margin: 0 auto; 
    height: 1.979vw; 
    border-radius: 52.031vw;
    border: 0.052vw solid {{section.settings.bar_border_color}};
  }
  .sale-wrap .sale-list .sale-item .progress-wrap .progress-bar {
    position: relative;
    width: 2.604vw;
    background: {{section.settings.bar_bg_color}};
    height: 100%;
    border-radius: 52.031vw;
  }
  .sale-wrap .sale-list .sale-item .progress-wrap .progress-bar .nums {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    font-size: 1.042vw;
    font-weight: 500;
    right: -1.563vw;
    color: {{section.settings.bar_text_color}};
  }
  .sale-wrap .sale-list .sale-item .product-name {
    padding: 0 20px;
    margin: 0 auto;
    font-size: 24px;
    font-weight: bold;
    font-family: 'HarmonyOS_Sans_SC_Bold';
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    margin-bottom: 12px;
  }
  .sale-wrap .sale-list .sale-item .product-form__buttons {
    width: 20.208vw;
    margin: 0 auto;
    margin-top: 16px;
  }
  .sale-wrap .sale-list .sale-item .product-form__buttons .add-cart {
    background-color: {{section.settings.jg_color}};
    color: {{section.settings.jg_text_color}}; 
    font-size: 18px;
    font-weight: 600;
  }
  @media (max-width: 767px) { 
    #container-{{section.id}} {
      padding-top: {{ section.settings.mg_top_mobile | append: 'px' }};
      padding-bottom: {{ section.settings.mg_bottom_mobile | append: 'px' }}
    }
    .sale-wrap { 
      width: 100%;
      margin: 0 auto;
      padding: 0 4.267vw;
    }
    .sale-wrap .sale-title {
      font-family: 'HarmonyOS_Sans_SC_Bold';
      font-size: 5.679vw;
      font-weight: 600;
      text-align: center;
      margin-bottom: 0.833vw;
    }
    .sale-wrap .sale-subtitle {
      font-family: 'HarmonyOS_Sans_SC_Bold';
      font-size: 3.867vw;
      font-weight: 500;
      text-align: center;
      margin-bottom: 8.000vw;
    }
    .sale-wrap .sale-list {
      display: flex;
    }
    .sale-wrap .sale-list .sale-item {
      /* padding: 5.333vw 8.000vw 13.333vw 8.000vw; */
      border-radius: 4.000vw;
      overflow: hidden;
      position: relative;
      flex: 1;
      margin-right: 5.333vw;
      background-color: #fff;
      padding-bottom: 5.333vw;
    }
    .sale-wrap .sale-list .sale-item:last-child {
      margin-right: 0;
    }
    .sale-wrap .sale-list .sale-item .sale-icon-wrap {
      width: 17.333vw;
      position: absolute;
      right: 1.333vw;
      top: 0;
    }
    .sale-wrap .sale-list .sale-item .sale-icon-wrap .discount {
      position: absolute;
      font-size: 4.800vw;
      right: 5.333vw;
      font-weight: 600;
      color: #fff;
      top: 5.600vw;
    }
    .sale-wrap .sale-list .sale-item .sale-icon-wrap .off {
      position: absolute;
      font-size: 3.200vw;
      right: 5.067vw;
      font-weight: 400;
      color: #fff;
      top: 11.467vw;
    }
    .sale-wrap .sale-list .sale-item .sale-icon-wrap .sale-icon {
      width: 100%;
    }
    .sale-wrap .sale-list .sale-item .product-img {
      width: 100%;
    }
    .sale-wrap .sale-list .sale-item .progress-wrap {
      width: 39.667vw;
      margin: 0 auto;
      height: 6.467vw;
      border-radius: 266.400vw;
      border: 0.267vw solid {{section.settings.bar_border_color}};
    } 
    .sale-wrap .sale-list .sale-item .progress-wrap .progress-bar {
      position: relative;
      width: 13.333vw;
      background: {{section.settings.bar_bg_color}};
      height: 100%;
      border-radius: 266.400vw;
    }
    .sale-wrap .sale-list .sale-item .progress-wrap .progress-bar .nums {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      font-size: 5.333vw;
      font-weight: 500;
      right: -8.000vw;
      color: {{section.settings.bar_text_color}};
    }
    .sale-wrap .sale-list .sale-item .product-name {
      padding: 0 2.667vw;
      margin: 0 auto;
      font-size: 3.467vw;
      font-weight: bold;
      font-family: 'HarmonyOS_Sans_SC_Bold';
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      margin-bottom: 2.133vw;
    }
    .sale-wrap .sale-list .sale-item .product-form__buttons {
      width: 39.667vw;
      margin: 0 auto;
      margin-top: 1.333vw;
    }
    .sale-wrap .sale-list .sale-item .product-form__buttons .add-cart {
      background-color: {{section.settings.jg_color}};
      color: {{section.settings.jg_text_color}}; 
      font-size: 4.267vw;
      font-weight: 600;
    }
  }
  
</style>
<div id="container-{{section.id}}">
  <div class="sale-wrap">
    <div class="sale-title fadein">{{section.settings.title}}</div> 
    <div class="sale-subtitle fadein">{{section.settings.subtitle}}</div>
    <div class="sale-list">
      <div class="sale-item">
        {% assign product1 = all_products[section.settings.product_1] %}
        {% assign quantity2 = product1.variants[0].inventory_quantity %}
        <div class="sale-icon-wrap">
          {% assign original_price = product1.price %}
          {% assign discount_price = product1.compare_at_price %}
          {% if discount_price and discount_price > original_price %}
            {% assign discount_amount = discount_price | minus: original_price %} 
            {% assign discount_percentage = discount_amount | times: 100.0 | divided_by: discount_price %}
          {% endif %}
          <img class="sale-icon" src="https://cdn.shopifycdn.net/s/files/1/0799/8714/7049/files/4_d15efc5d-cbbf-43d5-a8de-b1258c0c7e4c.png?v=1720491684" alt="sale icon">
          <div class="discount">{{ discount_percentage | round |  append: '%' }}</div>
          <div class="off">OFF</div>
        </div>  
        <a href="{{ product1.url }}">
          <img class="product-img" srcset="
            {%- if product1.featured_media.width >= 533 -%}
                {{ product1.featured_media | img_url: '533x' }} 533w,
            {%- endif -%}
            {%- if product1.featured_media.width >= 534 -%}
                {{ product1.featured_media | img_url: '534x' }} 534w,
            {%- endif -%}
            {%- if product1.featured_media.width >= 720 -%}
                {{ product1.featured_media | img_url: '720x' }} 720w,
            {%- endif -%}
            {%- if product1.featured_media.width >= 940 -%}
                {{ product1.featured_media | img_url: '940x' }} 940w,
            {%- endif -%}
            {%- if product1.featured_media.width >= 1066 -%}
                {{ product1.featured_media | img_url: '1066x' }} 1066w
            {%- endif -%}"
            src="{{ product1.featured_media | img_url: '533x' }}"
            sizes="(min-width: 1100px) 535px, (min-width: 750px) calc((100vw - 130px) / 2), calc((100vw - 50px) / 2)"
            alt="{{ product1.featured_media.alt | escape }} {{product1.featured_media.width}}"
            loading="lazy"
            class="motion-reduce"
          >
        </a>
        <div class="product-name">{{ product1.title }}</div>
        <div class="progress-wrap"> 
          <div class="progress-bar" style="width: {{quantity2 | times: 1.0 | divided_by: section.settings.products_quantity_base | times: 100 |  append: '%'}};">
            <div class="nums">{{quantity2}}</div> 
          </div>
        </div> 
        {%- form 'product', product1, id: product1.id, class: 'form productView-action', novalidate: 'novalidate', data-type: 'add-to-cart-form' -%}
          <div class="productView-group">
            <div class="productView-groupTop">
              <div class="productView-action">
                <input
                  type="hidden"
                  name="id"
                  value="{{ product1.variants[0].id }}">
                <div class="product-form__buttons"> 
                  <button
                    type="submit"
                    name="add"
                    data-btn-addToCart
                    class="add-cart product-form__submit button"
                    id="product-quick-shop-add-to-cart">
                    Add To Cart
                  </button>
                </div>
              </div>
            </div>
          </div>
        {%- endform -%}
      </div>
      <div class="sale-item">
        {% assign product2 = all_products[section.settings.product_2] %}
        {% assign quantity2 = product2.variants[0].inventory_quantity %}
        <div class="sale-icon-wrap">
          {% assign original_price = product2.price %} 
          {% assign discount_price = product2.compare_at_price %}
          {% if discount_price and discount_price > original_price %}
            {% assign discount_amount = discount_price | minus: original_price %} 
            {% assign discount_percentage = discount_amount | times: 100.0 | divided_by: discount_price %}
          {% endif %}
          <img class="sale-icon" src="https://cdn.shopifycdn.net/s/files/1/0799/8714/7049/files/4_d15efc5d-cbbf-43d5-a8de-b1258c0c7e4c.png?v=1720491684" alt="sale icon">
          <div class="discount">{{ discount_percentage | round |  append: '%' }}</div>
          <div class="off">OFF</div>
        </div> 
        <a href="{{ product2.url }}">
          <img class="product-img" srcset="
            {%- if product2.featured_media.width >= 533 -%}
                {{ product2.featured_media | img_url: '533x' }} 533w,
            {%- endif -%}
            {%- if product2.featured_media.width >= 534 -%}
                {{ product2.featured_media | img_url: '534x' }} 534w,
            {%- endif -%}
            {%- if product2.featured_media.width >= 720 -%}
                {{ product2.featured_media | img_url: '720x' }} 720w,
            {%- endif -%}
            {%- if product2.featured_media.width >= 940 -%}
                {{ product2.featured_media | img_url: '940x' }} 940w,
            {%- endif -%}
            {%- if product2.featured_media.width >= 1066 -%}
                {{ product2.featured_media | img_url: '1066x' }} 1066w
            {%- endif -%}"
            src="{{ product2.featured_media | img_url: '533x' }}"
            sizes="(min-width: 1100px) 535px, (min-width: 750px) calc((100vw - 130px) / 2), calc((100vw - 50px) / 2)"
            alt="{{ product2.featured_media.alt | escape }} {{product2.featured_media.width}}"
            loading="lazy"
            class="motion-reduce"
          >
        </a>
        <div class="product-name">{{ product2.title }}</div>
        <div class="progress-wrap"> 
          <div class="progress-bar" style="width: {{quantity2 | times: 1.0 | divided_by: section.settings.products_quantity_base | times: 100 |  append: '%'}};">
            <div class="nums">{{quantity2}}</div> 
          </div>
        </div>
        {%- form 'product', product2, id: product2.id, class: 'form productView-action', novalidate: 'novalidate', data-type: 'add-to-cart-form' -%}
          <div class="productView-group">
            <div class="productView-groupTop">
              <div class="productView-action">
                <input
                  type="hidden"
                  name="id"
                  value="{{ product2.variants[0].id }}">
                <div class="product-form__buttons"> 
                  <button
                    type="submit"
                    name="add"
                    data-btn-addToCart
                    class="add-cart product-form__submit button"
                    id="product-quick-shop-add-to-cart">
                    Add To Cart
                  </button>
                </div>
              </div>
            </div>
          </div>
        {%- endform -%}
      </div>
    </div>
  </div>
</div>

<script type="module">
  function fadeInListen () { 
		var fadeIn = $('#container-{{section.id}}').find('.fadein');
		fadeIn.each(function () {
			let element = this;
			let {
				scrub,
				reverse,
				duration,
				actions,
				fn
			} = $(this).data()

			gsap.set(element, { 
				opacity: 0,
				y: 20
			});
			let toggleActions = "play none none none";
			let start = $(this).data('start') || 70; 
			duration ? '' : duration = 0.8
			let tl = gsap.to(element, {
				opacity: 1,
				y: 0,
				duration
			});
			if (reverse) {
				toggleActions = "play none none reverse"
			}

			ScrollTrigger.create({
				animation: tl,
				trigger: element,
				toggleActions,
				start: `top ${start}%`, // 调整触发点，视情况而定
				onEnter: function () {

				},
				once: true // 只触发一次
			});
		});
	}
	fadeInListen();
</script>

{% schema %}
  {
    "name": "creality limited sale",
    "settings": [
      {
        "type": "text",
        "id": "title",
        "label": "标题"
      },
      {
        "type": "text", 
        "id": "subtitle",
        "label": "副标题"
      },
      {
        "type": "product",
        "id": "product_1",
        "label": "产品1"
      },
      {
        "type": "product",
        "id": "product_2",
        "label": "产品2" 
      },
      {
        "type": "number",
        "id": "products_quantity_base",
        "label": "产品库存基数",
        "default": 30
      },
      {
        "type": "text",
        "id": "bar_bg_color",
        "label": "进度条背景颜色",
        "default": "linear-gradient(to right, #E85E08 0%, #FFA257 100%)"
      },
      {
        "type": "color",
        "id": "bar_border_color",
        "label": "进度条边框颜色",
        "default": "#E9600A"
      }, 
      {
        "type": "color",
        "id": "bar_text_color",
        "label": "进度条字体颜色",
        "default": "#E9600A"
      },
      {
        "type": "color",
        "id": "bg_color",
        "label": "背景颜色",
        "default": "#f5f5f5"
      }, 
      {
        "type": "color",
        "id": "jg_color",
        "label": "加购按钮背景色",
        "default": "#E9600A"
      },
      {
        "type": "color",
        "id": "jg_text_color",
        "label": "加购按钮字体颜色",
        "default": "#ffffff"
      },
      {
        "type": "header",
        "content": "t:sections.layout.margin_top"
      },
      {
        "type": "range",
        "id": "mg_top_desktop",
        "label": "t:sections.layout.mg_desktop.label",
        "min": 0,
        "max": 150,
        "step": 5,
        "unit": "t:sections.layout.mg_desktop.unit",
        "default": 50
      },
      {
        "type": "range",
        "id": "mg_top_tablet",
        "label": "t:sections.layout.mg_tablet.label",
        "min": 0,
        "max": 150,
        "step": 5,
        "unit": "t:sections.layout.mg_desktop.unit",
        "default": 50
      },
      {
        "type": "range",
        "id": "mg_top_mobile",
        "label": "t:sections.layout.mg_mobile.label",
        "min": 0,
        "max": 150,
        "step": 5,
        "unit": "t:sections.layout.mg_desktop.unit",
        "default": 50
      },
      {
        "type": "header",
        "content": "t:sections.layout.margin_bottom"
      },
      {
        "type": "range",
        "id": "mg_bottom_desktop",
        "label": "t:sections.layout.mg_desktop.label",
        "min": 0,
        "max": 150,
        "step": 5,
        "unit": "t:sections.layout.mg_desktop.unit",
        "default": 50
      },
      {
        "type": "range",
        "id": "mg_bottom_tablet",
        "label": "t:sections.layout.mg_tablet.label",
        "min": 0,
        "max": 150,
        "step": 5,
        "unit": "t:sections.layout.mg_desktop.unit",
        "default": 50
      },
      {
        "type": "range",
        "id": "mg_bottom_mobile",
        "label": "t:sections.layout.mg_mobile.label",
        "min": 0,
        "max": 150,
        "step": 5,
        "unit": "t:sections.layout.mg_desktop.unit",
        "default": 50
      }
    ],
    "blocks": [],
    "presets": [
      {
        "name": "creality limited sale",
        "category": {
          "en-US": "limited sale",
          "zh-CN": "limited sale"
        },
        "blocks": []
      }
    ]
  }
{% endschema %}