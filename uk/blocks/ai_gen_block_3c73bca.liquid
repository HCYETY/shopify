{% doc %}
  @prompt
    Create a clearance items section with a responsive 2-column grid layout on mobile devices. Ensure product images display properly with correct aspect ratios and loading. Include product cards with sale badges, original and discounted prices, and clear "Sale" or "Clearance" indicators. The section should have optimized image display and be perfect for showcasing discounted products on mobile.

{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-clearance-section-{{ ai_gen_id }} {
    padding: {{ block.settings.section_padding }}px 20px;
    background-color: {{ block.settings.background_color }};
  }

  .ai-clearance-container-{{ ai_gen_id }} {
    max-width: 1200px;
    margin: 0 auto;
  }

  .ai-clearance-header-{{ ai_gen_id }} {
    text-align: center;
    margin-bottom: 40px;
  }

  .ai-clearance-title-{{ ai_gen_id }} {
    font-size: {{ block.settings.title_size }}px;
    color: {{ block.settings.title_color }};
    margin: 0 0 10px;
    font-weight: 700;
  }

  .ai-clearance-subtitle-{{ ai_gen_id }} {
    font-size: {{ block.settings.subtitle_size }}px;
    color: {{ block.settings.subtitle_color }};
    margin: 0;
  }

  .ai-clearance-grid-{{ ai_gen_id }} {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 30px;
  }

  @media screen and (max-width: 749px) {
    .ai-clearance-grid-{{ ai_gen_id }} {
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
    }
  }

  .ai-clearance-product-card-{{ ai_gen_id }} {
    background: {{ block.settings.card_background }};
    border-radius: {{ block.settings.card_border_radius }}px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .ai-clearance-product-card-{{ ai_gen_id }}:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
  }

  .ai-clearance-image-wrapper-{{ ai_gen_id }} {
    position: relative;
    width: 100%;
    aspect-ratio: {{ block.settings.image_aspect_ratio }};
    overflow: hidden;
  }

  .ai-clearance-image-{{ ai_gen_id }} {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .ai-clearance-product-card-{{ ai_gen_id }}:hover .ai-clearance-image-{{ ai_gen_id }} {
    transform: scale(1.05);
  }

  .ai-clearance-badge-{{ ai_gen_id }} {
    position: absolute;
    top: 12px;
    left: 12px;
    background: {{ block.settings.badge_background }};
    color: {{ block.settings.badge_text_color }};
    padding: 6px 12px;
    border-radius: {{ block.settings.badge_border_radius }}px;
    font-size: 12px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    z-index: 2;
  }

  .ai-clearance-content-{{ ai_gen_id }} {
    padding: 20px;
  }

  @media screen and (max-width: 749px) {
    .ai-clearance-content-{{ ai_gen_id }} {
      padding: 15px;
    }
  }

  .ai-clearance-product-title-{{ ai_gen_id }} {
    font-size: {{ block.settings.product_title_size }}px;
    color: {{ block.settings.product_title_color }};
    margin: 0 0 8px;font-weight: 600;
    line-height: 1.3;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  @media screen and (max-width: 749px) {
    .ai-clearance-product-title-{{ ai_gen_id }} {
      font-size: {{ block.settings.product_title_size | times: 0.9 }}px;
    }
  }

  .ai-clearance-price-wrapper-{{ ai_gen_id }} {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 15px;
  }

  .ai-clearance-sale-price-{{ ai_gen_id }} {
    font-size: {{ block.settings.price_size }}px;
    color: {{ block.settings.sale_price_color }};
    font-weight: 700;
  }

  .ai-clearance-original-price-{{ ai_gen_id }} {
    font-size: {{ block.settings.price_size | times: 0.9 }}px;
    color: {{ block.settings.original_price_color }};
    text-decoration: line-through;
  }

  .ai-clearance-discount-{{ ai_gen_id }} {
    background: {{ block.settings.discount_background }};
    color: {{ block.settings.discount_text_color }};
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: 600;
  }

  .ai-clearance-button-{{ ai_gen_id }} {
    width: 100%;
    padding: 12px;
    background: {{ block.settings.button_background }};
    color: {{ block.settings.button_text_color }};
    border: none;
    border-radius: {{ block.settings.button_border_radius }}px;
    font-size: 14px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    cursor: pointer;
    transition: background-color 0.3s ease;
    text-decoration: none;
    display: inline-block;
    text-align: center;
  }

  .ai-clearance-button-{{ ai_gen_id }}:hover {
    background: {{ block.settings.button_hover_background }};
  }

  @media screen and (max-width: 749px) {
    .ai-clearance-button-{{ ai_gen_id }} {
      padding: 10px;
      font-size: 12px;
    }
  }

  .ai-clearance-empty-state-{{ ai_gen_id }} {
    text-align: center;
    padding: 60px 20px;
    color: #666;
  }

  .ai-clearance-empty-state-{{ ai_gen_id }} h3 {
    margin: 0 0 10px;
    font-size: 18px;
  }

  .ai-clearance-empty-state-{{ ai_gen_id }} p {
    margin: 0;
    font-size: 14px;
  }
{% endstyle %}

<div class="ai-clearance-section-{{ ai_gen_id }}" {{ block.shopify_attributes }}>
  <div class="ai-clearance-container-{{ ai_gen_id }}">
    {% if block.settings.section_title != blank or block.settings.section_subtitle != blank %}
      <div class="ai-clearance-header-{{ ai_gen_id }}">
        {% if block.settings.section_title != blank %}
          <h2 class="ai-clearance-title-{{ ai_gen_id }}">{{ block.settings.section_title }}</h2>
        {% endif %}
        {% if block.settings.section_subtitle != blank %}
          <p class="ai-clearance-subtitle-{{ ai_gen_id }}">{{ block.settings.section_subtitle }}</p>
        {% endif %}
      </div>
    {% endif %}

    {% if block.settings.collection != blank %}
      {% assign clearance_products = block.settings.collection.products | limit: block.settings.products_limit %}
      
      {% if clearance_products.size > 0 %}
        <div class="ai-clearance-grid-{{ ai_gen_id }}">
          {% for product in clearance_products %}
            <div class="ai-clearance-product-card-{{ ai_gen_id }}">
              <div class="ai-clearance-image-wrapper-{{ ai_gen_id }}">
                {% if product.featured_image %}
                  <img
                    src="{{ product.featured_image | image_url: width: 600 }}"
                    alt="{{ product.featured_image.alt | escape }}"
                    class="ai-clearance-image-{{ ai_gen_id }}"
                    loading="lazy"
                    width="600"
                    height="{{ 600 | divided_by: block.settings.image_aspect_ratio }}"
                  >
                {% else %}
                  <div class="ai-clearance-image-placeholder-{{ ai_gen_id }}">
                    {{ 'product-1' | placeholder_svg_tag }}
                  </div>
                {% endif %}

                {% if product.compare_at_price > product.price %}
                  {% assign discount_percentage = product.compare_at_price | minus: product.price | times: 100 | divided_by: product.compare_at_price %}
                  <div class="ai-clearance-badge-{{ ai_gen_id }}">
                    {% if block.settings.badge_type == 'percentage' %}
                      {{ discount_percentage }}% OFF
                    {% else %}
                      {{ block.settings.custom_badge_text }}
                    {% endif %}
                  </div>
                {% endif %}
              </div>

              <div class="ai-clearance-content-{{ ai_gen_id }}">
                <h3 class="ai-clearance-product-title-{{ ai_gen_id }}">
                  <a href="{{ product.url }}">{{ product.title }}</a>
                </h3>

                <div class="ai-clearance-price-wrapper-{{ ai_gen_id }}">
                  <span class="ai-clearance-sale-price-{{ ai_gen_id }}">{{ product.price | money }}</span>
                  {% if product.compare_at_price > product.price %}
                    <span class="ai-clearance-original-price-{{ ai_gen_id }}">{{ product.compare_at_price | money }}</span>
                    {% if block.settings.show_discount_amount %}
                      {% assign discount_percentage = product.compare_at_price | minus: product.price | times: 100 | divided_by: product.compare_at_price %}
                      <span class="ai-clearance-discount-{{ ai_gen_id }}">-{{ discount_percentage }}%</span>
                    {% endif %}
                  {% endif %}
                </div>

                <a href="{{ product.url }}" class="ai-clearance-button-{{ ai_gen_id }}">
                  {{ block.settings.button_text }}
                </a>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="ai-clearance-empty-state-{{ ai_gen_id }}">
          <h3>No clearance items found</h3>
          <p>Add products to your selected collection to display them here.</p>
        </div>
      {% endif %}
    {% else %}
      <div class="ai-clearance-empty-state-{{ ai_gen_id }}">
        <h3>Select a collection</h3>
        <p>Choose a collection containing your clearance products to get started.</p>
      </div>
    {% endif %}
  </div>
</div>

{% schema %}
{
  "name": "Clearance items",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "section_title",
      "label": "Section title",
      "default": "Clearance Sale"
    },
    {
      "type": "text",
      "id": "section_subtitle",
      "label": "Section subtitle",
      "default": "Limited time offers on selected items"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    },
    {
      "type": "range",
      "id": "products_limit",
      "label": "Number of products",
      "min": 2,
      "max": 20,
      "step": 2,
      "default": 8
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button text",
      "default": "Shop Now"
    },
    {
      "type": "header",
      "content": "Badge settings"
    },
    {
      "type": "select",
      "id": "badge_type",
      "label": "Badge type",
      "options": [
        {
          "value": "percentage",
          "label": "Discount percentage"
        },
        {
          "value": "custom",
          "label": "Custom text"
        }
      ],
      "default": "percentage"
    },
    {
      "type": "text",
      "id": "custom_badge_text",
      "label": "Custom badge text",
      "default": "SALE"
    },
    {
      "type": "checkbox",
      "id": "show_discount_amount",
      "label": "Show discount percentage in price",
      "default": true
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "select",
      "id": "image_aspect_ratio",
      "label": "Image aspect ratio",
      "options": [
        {
          "value": "1",
          "label": "Square (1:1)"
        },
        {
          "value": "1.33",
          "label": "Landscape (4:3)"
        },
        {
          "value": "0.75",
          "label": "Portrait (3:4)"
        }
      ],
      "default": "1"
    },
    {
      "type": "range",
      "id": "section_padding",
      "label": "Section padding",
      "min": 20,
      "max": 80,
      "step": 10,
      "unit": "px",
      "default": 50
    },
    {
      "type": "range",
      "id": "card_border_radius",
      "label": "Card border radius",
      "min": 0,
      "max": 20,
      "step": 2,
      "unit": "px",
      "default": 8
    },
    {
      "type": "range",
      "id": "badge_border_radius",
      "label": "Badge border radius",
      "min": 0,
      "max": 20,
      "step": 2,
      "unit": "px",
      "default": 4
    },
    {
      "type": "range",
      "id": "button_border_radius",
      "label": "Button border radius",
      "min": 0,
      "max": 20,
      "step": 2,
      "unit": "px",
      "default": 6
    },
    {
      "type": "header",
      "content": "Typography"
    },
    {
      "type": "range",
      "id": "title_size",
      "label": "Section title size",
      "min": 20,
      "max": 50,
      "step": 2,
      "unit": "px",
      "default": 32
    },
    {
      "type": "range",
      "id": "subtitle_size",
      "label": "Section subtitle size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "default": 16
    },
    {
      "type": "range",
      "id": "product_title_size",
      "label": "Product title size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "default": 16
    },
    {
      "type": "range",
      "id": "price_size",
      "label": "Price size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "default": 18
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Section background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Section title color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "subtitle_color",
      "label": "Section subtitle color",
      "default": "#666666"
    },
    {
      "type": "color",
      "id": "card_background",
      "label": "Card background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "product_title_color",
      "label": "Product title color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "sale_price_color",
      "label": "Sale price color",
      "default": "#d82c0d"
    },
    {
      "type": "color",
      "id": "original_price_color",
      "label": "Original price color",
      "default": "#999999"
    },
    {
      "type": "color",
      "id": "badge_background",
      "label": "Badge background",
      "default": "#d82c0d"
    },
    {
      "type": "color",
      "id": "badge_text_color",
      "label": "Badge text color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "discount_background",
      "label": "Discount tag background",
      "default": "#008060"
    },
    {
      "type": "color",
      "id": "discount_text_color",
      "label": "Discount tag text color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "button_background",
      "label": "Button background",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button text color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "button_hover_background",
      "label": "Button hover background",
      "default": "#333333"
    }
  ],
  "presets": [
    {
      "name": "Clearance items"
    }
  ],
  "tag": null
}
{% endschema %}